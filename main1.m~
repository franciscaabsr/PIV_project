clear all
close all 

%Prepare 
load ('./CalibData/cameraparametersAsus.mat');

d = dir ('./Cam1/*.png'); %lists the files in directory .jpg or .png (all the rgb images)
dd = dir('./Cam1/*.mat'); %lists the files in directory .mat (all the depth images)
imgs = [];

%need to sort images!!
assert(iscell(d),'First input <X> must be a cell array.')

for i = 1: length (d) %for each image in time
    im = imread(d(i).name);
    imgs = cat(3,imgs,im); 
    load(dd(i).name);
    imgsd(:,:,i) = double(depth_array)/1000; %store all depth_array
    [r,c] = ind2sub(size(imgsd(:,:,i)),find(imgsd(:,:,i))); %select (i,j) that correspond to entries non zero
    im_vec = reshape(imgsd(:,:,i),[480*640,1]); %vectorize
    xyz_depth = get_xyz_asus(im_vec, [480, 640], [r, c], cam_params.Kdepth, 1, 0); %compute xyz in depth reference frame
    rgbd = get_rgbd(xyz_depth, im, cam_params.R, cam_params.T, cam_params.Krgb); %compute rgb corresponding to xyz_depth
end
